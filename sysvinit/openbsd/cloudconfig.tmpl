## template:jinja
#!/bin/ksh

# PROVIDE: cloudconfig
# REQUIRE: cloudinit
# BEFORE: sshd


daemon="cloud-init"
daemon_execdir="{{prefix}}/bin"
daemon_flags="modules --mode config"
daemon_rtable=0
daemon_timeout=1
daemon_user=root

. /etc/rc.d/rc.subr

rc_bg="YES" # (undefined or "YES")
rc_usercheck="YES" # (undefined or "NO")

rc_start() {
    test -e /etc/cloud/cloud-init.disabled \
      && warn "cloud-init disabled by cloud-init.disabled file" \
      && exit 0
    rc_exec "${daemon_execdir}/${daemon} ${daemon_flags}"
}

rc_check() {
    pgrep -f "${daemon}" >/dev/null
}

rc_stop() {
    pkill -f "${daemon}" >/dev/null
}

rc_cmd "$1"
