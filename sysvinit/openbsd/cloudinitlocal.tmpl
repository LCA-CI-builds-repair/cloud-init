## template:jinja
#!/bin/ksh

# PROVIDE: cloudinitlocal
# REQUIRE: NETWORKING

# After NETWORKING because we don't want staticroute to wipe
# the route set by the DHCP client toward the meta-data server.

daemon="cloud-init"
daemon_execdir="{{prefix}}/bin"
daemon_flags="init -l"
daemon_rtable=0
daemon_timeout=1
daemon_user=root

. /etc/rc.d/rc.subr

rc_bg="YES" # (undefined or "YES")
rc_usercheck="YES"

rc_start() {
    test -e /etc/cloud/cloud-init.disabled \
      && warn "cloud-init disabled by cloud-init.disabled file" \
      && exit 0
    rc_exec "${daemon_execdir}/${daemon} ${daemon_flags}"
}

rc_check() {
    pgrep -f "${daemon}" >/dev/null
}

rc_stop() {
    pkill -f "${daemon}" >/dev/null
}

rc_cmd "$1"
